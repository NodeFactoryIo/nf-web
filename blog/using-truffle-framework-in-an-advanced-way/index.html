<!DOCTYPE html>
<html lang="en"><head>
    <meta http-equiv="Content-Type" content="text/html;" charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <base href="https://nodefactory.io">

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="../../apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
    <link rel="manifest" href="../../site.webmanifest">
    <link rel="mask-icon" href="../../safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">




<title>Using Truffle framework in an advanced way | NodeFactory</title>


<meta name="description" content="Few tips when coding smart contracts using Truffle framework.">



<meta content='ethereum development, truffle, ethereum tools, smart contracts development' name="keywords">







<!-- Open Graph data / Facebook Card data -->
<meta property="og:title" content="Using Truffle framework in an advanced way | NodeFactory">

<meta property="og:type" content="article">

<meta property="og:image" content="https://www.nodefactory.io/images/blog/truffle.png">
<meta property="og:image:alt" content="NodeFactory logo">

<meta property="og:description" content="Few tips when coding smart contracts using Truffle framework.">

<meta property="og:locale" content="en">
<meta property="og:url" content="https://nodefactory.io/blog/using-truffle-framework-in-an-advanced-way/">

<!-- Twitter Card data -->
<meta name="twitter:title" content="Using Truffle framework in an advanced way | NodeFactory">
<meta name="twitter:card" content="summary">

<meta property="twitter:description" content="Few tips when coding smart contracts using Truffle framework.">

<meta name="twitter:creator" content="@nodefactoryio">
<meta name="twitter:image" content="https://www.nodefactory.io/images/blog/truffle.png" />
<meta name="twitter:image:src" content="https://www.nodefactory.io/images/blog/truffle.png" />


    

    
    
        <script defer type="application/ld+json">
            {
              "@context": "http://schema.org",
              "@type": "Article",
              "headline": "Using Truffle framework in an advanced way",
              "author": {
                "@type": "Organization",
                "name": "NodeFactory"
              },
              "datePublished": "2018-06-26",
              "description": "Few tips when coding smart contracts using Truffle framework.",
              "wordCount":  542 ,
              "mainEntityOfPage": "True",
              "dateModified": "2018-06-26",
              "image": {
                "@type": "imageObject",
                "url": "https:\/\/www.nodefactory.io\/images\/blog\/truffle.png"
              },
              "publisher": {
                "@type": "Organization",
                "name": "NodeFactory - Blockchain research and development company",
                "logo": {
                  "@type": "imageObject",
                  "url": "https://www.nodefactory.io/images/NodeFactory_logo.png"
                }
              }
            }
          </script>
    

<!-- Mobile header color for Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#2c638f">
    <!-- Mobile header color Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#2c638f">
    <!-- Mobile header color for iOS Safari (supports black, black-translucent or default) -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!--Fonts-->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">

    <!-- Style load -->
    
    
        <link href="../../main.27d66.css" rel="stylesheet">
    

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-111993876-1" type="text/javascript"></script>
    <script async type="text/javascript">
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-111993876-1');
    </script>
    
</head><body>

    <div class="row landing"><header>
    <a href="../../">
        <img src="images/NodeFactory-transparent.png" alt="NodeFactory logo" class="hidden-xs hidden-sm" />
    </a>

    <nav class="col-md-12" id="menu-bar">
        <div id="menu">
            <i class="fa fa-bars hidden-md hidden-lg"></i>
        </div>

        <ul class="nav" id="nav">
            <li><a href="#services">Services</a></li>
            <li><a href="#projects">Projects</a></li>
            <li><a href="#testimonials">Testimonials</a></li>
            <li><a href="../../blog">Blog</a></li>
            <li><a href="#team">Team</a></li>
            <li><a href="../../portfolio">Portfolio</a></li>
        </ul>

    </nav>
    <div class="menu-bg" id="menu-bg"></div>
</header><section class="landingcontent blog-header">
            <div class="column">
                <h4>Using Truffle framework in an advanced way</h4>
                <p class="date">June 26th, 2018.</p>
            </div>

            <div class="illustrations">
                <img src="images/net.png" class="illustration-1" alt="network illustration">
            </div>
        </section>
    </div>

    <div class="blog-content-wrapper">
        
            <div class="row center">
                <div class="blog-image">
                    <img src="../../images/blog/truffle.png" alt="Using Truffle framework in an advanced way" />
                </div>
            </div>
        

        <div class="blog-content">
            

<h2 id="linking-and-initializing-contracts-on-deploy-automatically">Linking and initializing contracts on deploy automatically</h2>

<p>First, you should get familiar with the <a href="https://www.trufflesuite.com/docs/truffle/getting-started/running-migrations">truffle migrate</a> command that helps you deploy your contracts but also upgrade and redeploy the changed contracts only.</p>

<p>But what about the contracts that depend on other contracts that you are deploying as well? Contracts that are dependencies should be updated with the newly deployed address. You can do this manually during production but what about tests? Let’s dive into a solution.</p>

<p>For example, we have a smart contract called Application that interacts with Storage smart contract. The goal is to deploy them both and update Application contract with the Storage contract’s address.</p>

<p>Here is our <em>Application.sol</em> file:</p>

<script type="application/javascript" src="https://gist.github.com/mpetrunic/c4f136d6bede5f39f0a538bfa6f09e2f.js"></script>


<p>And our migration file:</p>

<script type="application/javascript" src="https://gist.github.com/mpetrunic/e1336ab8990128a00508009911a72fae.js"></script>


<p>The code above creates 4 transactions:</p>

<ol>
<li>Deployment of the Application contract</li>
<li>Deployment of the Storage contract</li>
<li>Updating storage address in Application contract</li>
<li>Updating Truffle’s Migrations contract that tracks migrations onchain</li>
</ol>

<p>To save up some gas, you could add constructor to Application contract which would accept address of storage contract as function parameter. Then our example would look like this:</p>

<script type="application/javascript" src="https://gist.github.com/mpetrunic/c3701d9b800a218fdd71ec3a68ea1c5d.js"></script>


<p>Migration of <code>Storage.sol</code> contract:</p>

<script type="application/javascript" src="https://gist.github.com/mpetrunic/0391fe8329dc4ae5c7013b85db0049ed.js"></script>


<p>And migration of <code>Application.sol</code> contract:</p>

<script type="application/javascript" src="https://gist.github.com/mpetrunic/f7b5b260cb998b78cea50873916a3c23.js"></script>


<p>This way we will make one transaction less than before and thus save some gas.</p>

<h2 id="testing-time-based-functions">Testing time based functions</h2>

<p>Often you will find yourself writing time-dependent code i.e. checking if a certain time has passed before withdraw/deposit. If you are using <a href="https://github.com/trufflesuite/ganache-cli">ganache-cli</a> for local network and testing, then you can use special RPC function <em>evm_increasetime</em> during your tests.</p>

<p>Here is how it can be used:</p>

<script type="application/javascript" src="https://gist.github.com/mpetrunic/d4497fb00c211d543d12d60aa2c93c67.js"></script>


<p>To wait during tests for 24 hours you can call:</p>

<p><code>await utils.increaseTime(24 * 60 * 60);</code></p>

<h2 id="mocha-multi-reporters">Mocha multi reporters</h2>

<p>If you are like us and you use some sort of CI (Continuous Integration) like <a href="https://circleci.com/">CircleCi</a>, you would probably want your test results in some common format. Most CI tools require test results in JUnit XML format.</p>

<p>Truffle by default uses spec reporter which nicely formats test result onto console window. You could easily change this to mocha-junit-reporter, it’s just matter of running <code>yarn install mocha-junit-reporter</code> and adding following mocha config entry in your <em>truffle.js</em> config file:</p>

<script type="application/javascript" src="https://gist.github.com/mpetrunic/256bbdf17e7cdd2a0d11fa7efdedd758.js"></script>


<p>This solution is nice for CI but it’s not very user friendly when it comes to running test locally and then checking xml file for test results. Luckily there is something called <a href="https://github.com/stanleyhlng/mocha-multi-reporters">mocha-multi-reporters</a>.</p>

<p>For configuring multi reporters, first install dependencies:</p>

<p><code>yarn install ---dev mocha-multi-reporters mocha-junit-reporter</code></p>

<p>Add following mocha configuration to your <em>truffle.js</em> config:</p>

<script type="application/javascript" src="https://gist.github.com/mpetrunic/efc09b662b2072ac07826426485f5239.js"></script>


<p>You’ve probably noticed that we are using <em>mocha-reporter-config.json</em>. Using this file, we can configure multi reporter to use both spec and mocha-junit-reporter.</p>

<script type="application/javascript" src="https://gist.github.com/mpetrunic/2906453963a55842a3be4ea7e24ef4b7.js"></script>


<p>As you might have probably noticed, you can even decide where you want your test results to be stored.</p>

<p>Developing dApps using Ethereum requires complex setup with whole bunch of frameworks and tools. Because of these we created <a href="https://github.com/NodeFactoryIo/solidity-node-docker-starter">starter repository</a> which has all tools and frameworks configured for you to develop smart contracts with Node.Js as backend server. Everything is put in containers using <a href="https://www.docker.com/">Docker</a> so with only one command you can start your private network, deploy contracts, run (database) migrations, run web server, tests and whatever you like.</p>

<p>If you want to try it, you can check it out here:</p>

<p><a href="https://github.com/NodeFactoryIo/solidity-node-docker-starter">https://github.com/NodeFactoryIo/solidity-node-docker-starter</a></p>

<p>You can let us know if you would like some more features in this repo or feel free to contribute!</p>

        </div>
    </div><section id="contact" class="wrapper contact">
    <div class="col-xs-12 col-sm-10 col-md-10">
        <div id="contact-background">
            <h2>Get in touch</h2>
            <p>Tell us about your project. Let’s see how we can make it happen!</p>

            <form action="https://formspree.io/info@nodefactory.io" method="POST">
                <div class="contact-Column">
                    <div class="input-row">
                        <div class="input-row-first-input">
                            <input aria-label="subject" type="text" name="subject"  placeholder="I'm interested in"/>
                        </div>

                        <div class="input-row-second-input">
                            <input aria-label="email" type="text" name="email"  placeholder="Email"/>
                        </div>
                    </div>
                </div>

                <div class="input-row">
                    <div class="input-row-third-input">
                        <input aria-label="Your company" type="text" name="company"  placeholder="Company"/>
                    </div>

                    <div class="input-row-fourth-input">
                        <input aria-label="Your name" type="text" name="name"  placeholder="Full name"/>
                    </div>
                </div>

                <div class="input-row">
                    <div class="input-row-fifth-input">
                        <input aria-label="Description" type="textarea" name="description"  placeholder="Project description"/>
                    </div>
                </div>

                <div class="input-row submit-row">
                    <div class="submit-button">
                        <input type="submit" value="TALK TO OUR TEAM"/>
                        <i class="fas fa-arrow-right"></i>
                    </div>
                </div>
            </form>
        </div>
    </div>
</section>
<footer>
    <div class="footer">
        <div>
            <div class="row flex-column">
                <a href="https://ubik.hr/" aria-label="UBIK" rel="noreferrer"><h3>Members of UBIK</h3></a>
                <a href="https://www.meetup.com/BUIDL-Zagreb/" aria-label="BUIDL Meetup" rel="noreferrer">
                    <h3>BUIDL meetup organizers</h3>
                </a>
            </div>
        </div>

        <div class="banners row">
            <a href="https://topappdevelopmentcompanies.com/directory/app-developers/blockchain" target="_blank">
                <img src="https://topappdevelopmentcompanies.com/badges/top-app-development-companies.png" alt="blockchain developers 2019" title="Blockchain Developers 2019"/>
            </a>

            <a target="_blank" href="https://www.goodfirms.co/company/nodefactory">
                <img class="larger" src="https://goodfirms.s3.amazonaws.com/badges/color-badge/list-blockchain-technology-companies.svg" alt="GoodFirms Badge">
            </a>
        </div>

        <div class="footer-cripto-payments">
            <img alt="DAI" src="images/icons/dai.png">
            <img alt="BTC" src="images/icons/btc.png">
            <img alt="ETH" src="images/icons/eth.png">
            <p>Crypto accepted</p>
        </div>
        <div class="footer-legal">

            <p>Node Factory d.o.o. Oreškovićeva 6v, 10000 Zagreb. VAT ID: HR34703059147. Banka: Erste&Steiermärkische Bank d.d., IBAN: HR7624020061100867083, Swift: ESBCHR22
                Tvrtka upisana pod brojem MBS 081152605 u Trgovačkom sudu u Zagrebu. Temeljni kapital od 20.000,00 kn uplaćen u cjelosti.
                Članovi uprave društva su Belma Gutlić i Marin Petrunić.</p>
        </div>

    </div>
</footer>



    <script src="../../main.27d66.js"></script>

</body>
</html>